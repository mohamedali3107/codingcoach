{% extends 'layouts/base.html' %}
{% block content %}
<style>
    #chat {
      height: 500px;
      border: 1px solid #000;
      margin-bottom: 100px;
      overflow-y: scroll;
      background-color: #fff;
      color: red;
  }
  .container {
      display: flex;
  }
  
  .container textarea {
      flex: 1;
      margin-right: 10px;
      font-size: 16px;
      color: red;
  }
  
  .container input[type="submit"] {
      flex-shrink: 0;
      background: white;
      color: white;
      border: 0px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
  }
  .user-messages{
      width: 100%;
      padding: 10px;
      background: #343541;
      color: #fff;
      font-size: 16px;
  }
  
  .chatbot-messages{
      width: 100%;
      padding: 10px;
      font-size: 16px;
      background: #444655;
      outline: none;
      color: white;
      ::-webkit-input-placeholder
  {
      color: #fff;
  }
  }
  .output-messages {
  padding: 8px;
  margin: 5px;
  border-radius: 5px;
  color: white;
  
  }
  
  .copy-icon {
  position: absolute;
  top: 8px;
  right: 8px;
  cursor: pointer}
  </style>
  <style>
    h1 {
        text-align: center;
    }
  </style>
  <body>
  <h1></h1>
  </body>
  <nav>
    <ul>
      <li><a href="{% url 'llmcoach:home' %}">Git_Assistant</a></li>
    <li><a href="{% url 'llmcoach:chat' %}">Code_Questions</a></li>
    <li><a href="{% url 'llmcoach:evaluation' %}">Code_Evaluator</a></li>
      
    </ul>
  </nav> 
  <div id="chat" style="height: calc(70vh - 16px); color: #fff; ">
  
      {% for message in chat %}
        {% if message.role == 'user' %}
          <div class="user-messages" style="color:white;" >
            <p>You: <pre style="white-space: pre-wrap; color: white;">{{ message.content | escape }}</pre></p>
          </div>
        {% elif message.role == 'assistant' %}
          {% if message.is_code %}
            <div class="code-messages" style="color:white;">
              <p>ChatBot: <pre>{{ message.content | escape }}</pre></p>
            </div>
          {% elif message.is_output %}
            <div class="output-messages" style="width: 100%; padding: 10px; bottom: 20px;color: white; margin-bottom: 10px;">
              <p>ChatBot: <pre style="white-space: pre-wrap;">{{ message.content | escape }}</pre></p>
              <span class="copy-icon" onclick="copyToClipboard('{{ message.content | escape }}')">ðŸ“‹</span>
            </div>
          {% else %}
            <div class="chatbot-messages">
              <p>ChatBot: <pre style="white-space: pre-wrap; color: white;">{{ message.content | escape }}</pre></p>
            </div>
          {% endif %}
        {% endif %}
      {% endfor %}
    </div>
    <form id="chat-form" method="POST" style="position: relative; bottom: 0; left: 55; width: 100%; color: #fff; padding: 20px; box-sizing: border-box; display: flex; justify-content: space-between; align-items: center;">
      {% csrf_token %}
      <textarea rows="2" class="centered-textarea" id="user-input" type="text" name="user_input" placeholder="Your message" style="flex: 2; margin-right: 16px; font-size: 16px;"></textarea>
      <input type="submit" value="Send" style="flex-shrink: 0; color: black;  border: 0px; padding: 5px 10px; font-size: 16px; cursor: pointer; background: green;
      ">
    </form>
    
  <script>
      document.addEventListener('DOMContentLoaded', () => {
          const chatForm = document.getElementById('chat-form');
          const userInput = document.getElementById('user-input');
          const chat = document.getElementById('chat');
  
          // Function to scroll conversation to the bottom
          function scrollConversation() {
              conversation.scrollTop = chat.scrollHeight;
          }
  
          // Function to submit the form
          function submitForm() {
              chatForm.submit();
          }
  
          // Event listener to submit the form when Enter key is pressed
          userInput.addEventListener('keypress', (event) => {
              if (event.key === 'Enter') {
                  event.preventDefault();
                  submitForm();
              }
          });
  
          // Focus on the user input field
          userInput.focus();
  
          // Scroll conversation to the bottom initially
          scrollChat();
  
          // Example usage of addCodeMessage
          // addCodeMessage("Your code goes here");
  
          // Example usage of copyToClipboard
          // copyToClipboard("Content to copy");
      });
  
      // Function to add a code message to the conversation
          function addCodeMessage(content) {
            const conversation = document.getElementById('chat');
            const codeMessage = document.createElement('div');
            codeMessage.className = 'code-messages';
            codeMessage.innerHTML = `<p>ChatBot: <pre>${content}</pre></p>`;
            conversation.appendChild(codeMessage);
            scrollChat(); // Scroll to the bottom after adding the message
      }
  
      // Function to copy content to clipboard
          function copyCode() {
            const codeElement = document.querySelector('.language-any code');
            const codeToCopy = codeElement.textContent;
    
            const textarea = document.createElement('textarea');
            textarea.value = codeToCopy;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
    
            alert('Code copied to clipboard!');
      }
  </script>  
  {% endblock %}