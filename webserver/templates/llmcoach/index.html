{% extends 'layouts/base.html' %}

{% block styles %}
<style>
  #conversation {
     height: 500px;
     border: 1px solid #000;
     margin-bottom: 100px;
     overflow-y: scroll;
     background-color: #424755;
 }
 .container {
     display: flex;
 }

 .container textarea {
     flex: 1;
     margin-right: 10px;
     font-size: 16px;
 }

 .container input[type="submit"] {
     flex-shrink: 0;
     background: #10a37f;
     color: #fff;
     border: 0px;
     padding: 8px 16px;
     font-size: 14px;
     cursor: pointer;
 }
 .user-messages{
     width: 100%;
     padding: 10px;
     background: #343541;
     color: #fff;
 }
 .chatbot-messages{
     width: 100%;
     padding: 10px;
     background: #444655;
     color: #fff;
 }
 .code-messages {
 background-color: #e6e6e6; /* Light gray background for code messages */
 padding: 8px;
 margin: 5px;
 border-radius: 5px;

}

 .copy-icon {
 position: absolute;
 top: 8px;
 right: 8px;
 cursor: pointer}
</style>
{% endblock %}


{% block content %}
<h1>Hello Student!</h1>
<div id="conversation">
    {% for message in conversation %}
        {% if message.role == 'user' %}
            <div class="user-messages"><p>You: <pre>{{ message.content | escape }}</pre></p></div>
        {% elif message.role == 'assistant' %}
            {% if message.is_code %}
                <div class="code-messages"><p>ChatBot: <pre>{{ message.content | escape }}</pre></p></div>
            {% elif message.is_output %}
                <div class="output-messages">
                    <p>ChatBot: <pre>{{ message.content | escape }}</pre></p>
                    <span class="copy-icon" onclick="copyToClipboard('{{ message.content | escape }}')">ðŸ“‹</span>
                </div>
            {% else %}
                <div class="chatbot-messages"><p>ChatBot: <pre>{{ message.content | escape }}</pre></p></div>
            {% endif %}
        {% endif %}
    {% endfor %}
</div>
    
<form id="chat-form" method="POST">
    {% csrf_token %}
    <div class="container">
        <textarea rows="3" class="centered-textarea" id="user-input" type="text" name="user_input" placeholder="Your message"></textarea>
        <input type="submit" value="Send">
    </div>
</form>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const chatForm = document.getElementById('chat-form');
        const userInput = document.getElementById('user-input');
        const conversation = document.getElementById('conversation');

        // Function to scroll conversation to the bottom
        function scrollConversation() {
            conversation.scrollTop = conversation.scrollHeight;
        }

        // Function to submit the form
        function submitForm() {
            chatForm.submit();
        }

        // Event listener to submit the form when Enter key is pressed
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                event.preventDefault();
                submitForm();
            }
        });

        // Focus on the user input field
        userInput.focus();

        // Scroll conversation to the bottom initially
        scrollConversation();

        // Example usage of addCodeMessage
        // addCodeMessage("Your code goes here");

        // Example usage of copyToClipboard
        // copyToClipboard("Content to copy");
    });

    // Function to add a code message to the conversation
    function addCodeMessage(content) {
        const conversation = document.getElementById('conversation');
        const codeMessage = document.createElement('div');
        codeMessage.className = 'code-messages';
        codeMessage.innerHTML = `<p>ChatBot: <pre>${content}</pre></p>`;
        conversation.appendChild(codeMessage);
        scrollConversation(); // Scroll to the bottom after adding the message
    }

    // Function to copy content to clipboard
    function copyToClipboard(content) {
        const el = document.createElement('textarea');
        el.value = content;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        alert('Copied to clipboard!');
    }
</script>


{% endblock %}
