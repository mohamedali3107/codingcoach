{% extends 'layouts/base.html' %}
{% load static %}

{% block content %}
    <div class="grid grid-cols-2 gap-4 p-4">
    <div class="row">
    
      
        <!--[ Recent Users ] start-->
        <div class="col-xl-12 col-md-12">
          <div class="card Recent-Users">
    
            
    
            <div class="card-header">
            <h5>Dashboard
                <a href="#" id="refreshLink" class="label theme-bg2 text-white f-12" >Refresh
                </a>
            </h5>
            <div id="loadingMessage" style="display: none;">Please wait, the data is being updated...</div>

            <!-- Include jQuery library -->
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

            <script>
                $(document).ready(function() {
                $('#refreshLink').click(function(e) {
                    e.preventDefault(); // Prevent default link behavior (i.e., navigating to #)

                    // Show loading message while the updateRepo process is running
                    $('#loadingMessage').show();

                    $.ajax({
                    url: 'updateRepo/',
                    method: 'GET',
                    success: function(response) {
                        // Handle the response from the Django view
                        console.log('Success:', response);
                        // Hide loading message after successful updateRepo execution
                        $('#loadingMessage').hide();
                        // Reload the current page after successful updateRepo execution
                        location.reload()
                    },
                    error: function(xhr, status, error) {
                        $('#loadingMessage').hide();
                        // Handle errors
                        console.error('Error:', error);
                    }
                    });
                });
                });
            </script>
            </div>

            <div class="card-block px-0 py-3">
            <div class="table-responsive">
                <table class="table table-hover">

                <thead>
                    <tr>
                    <th></th>
                    <th>Team Name</th>
                    <th>Number of branches</th>
                    <th>Branches behind main</th>
                    <th>Branches ahead main</th>
                    <th>Commit Quality</th>
                    <th>Moods</th>
                    <th>Time Stamp</th>
                    </tr>
                </thead>

                <tbody>
                    {% for team, data in data.team_data.items %}

                    <tr class="unread">
                        <td><img class="rounded-circle" style="width:40px;" src="{% static 'assets/images/user/avatar-1.jpg' %}"
                            alt="activity-user">
                        </td>
                        
                        <td>
                        <h6 class="mb-1">{{ team.teamName }}</h6>
                        {% comment %} <p class="m-0">{{ p.info }}</p> {% endcomment %}
                        </td>

                        <td>
                        <h6 class="text-muted">
                            <i>{{ data.repo.branchNumber }}</i>
                        </h6>
                        </td>

                        <td>
                        <h6 class="text-muted">
                            <i>{{ data.repo.branchBehindMax }}</i>
                        </h6>
                        </td>

                        <td>
                        <h6 class="text-muted">
                            <i>{{ data.repo.branchAheadMax }}</i>
                        </h6>
                        </td>

                        <td>
                        <h6 class="text-muted">
                            <i>{{ data.repo.commitQuality }}</i>
                        </h6>
                        </td>
                        
                        <td>
                        <h6 class="text-muted">
                            {% for mood in data.moods %}
                            <i>{{ mood }}</i>
                        {% endfor %}
                        </h6>
                        </td>

                        <td>
                        <h6 class="text-muted">
                            <i>{{ data.repo.timeStamp }}</i>
                        </h6>
                        </td>

                        <td>
                        <a href="#" class="label theme-bg2 text-white f-12">View</a>
                        <a href="suppressTeam/?teamName={{ team.teamName }}" class="label theme-bg text-white f-12">Delete</a>
                        </td>
                    </tr>

                    {% endfor %}
                </tbody>
                </table>
            </div>
            </div>
    
{% endblock %}
